

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6. Profile cells with DeepProfiler &#8212; Handbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'docs/06-profiling';</script>
    <link rel="shortcut icon" href="../_static/favicon_32.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Training models with DeepProfiler" href="07-train.html" />
    <link rel="prev" title="5. Configuration file and examples" href="05-config.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="00-welcome.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/banner.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/banner.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00-welcome.html">
                    Welcome to DeepProfiler
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-install.html">1. Install DeepProfiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-structure.html">2. Project structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-images.html">3. Images and segmentation masks</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-metadata.html">4. Metadata and single-cell locations</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-config.html">5. Configuration file and examples</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">6. Profile cells with DeepProfiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-train.html">7. Training models with DeepProfiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-process.html">8. Downstream analysis</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cytomining/DeepProfiler-handbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cytomining/DeepProfiler-handbook/edit/main/DeepProfiler-Handbook/docs/06-profiling.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cytomining/DeepProfiler-handbook/issues/new?title=Issue%20on%20page%20%2Fdocs/06-profiling.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/docs/06-profiling.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>6. Profile cells with DeepProfiler</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-profiling-information"><strong>6.1 General profiling information:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#profiling-with-cell-painting-cnn-model"><strong>6.2 Profiling with Cell Painting CNN model:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#profiling-with-imagenet-pre-trained-model"><strong>6.3 Profiling with ImageNet pre-trained model:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#profiling-with-your-own-trained-model"><strong>6.4 Profiling with your own trained model:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-project-dependent-functions"><strong>Optional project-dependent functions:</strong></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="profile-cells-with-deepprofiler">
<h1>6. Profile cells with DeepProfiler<a class="headerlink" href="#profile-cells-with-deepprofiler" title="Permalink to this heading">#</a></h1>
<p>DeepProfiler allows profiling the data using self-trained models or pre-trained models.</p>
<section id="general-profiling-information">
<h2><strong>6.1 General profiling information:</strong><a class="headerlink" href="#general-profiling-information" title="Permalink to this heading">#</a></h2>
<p>General example command to run profiling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">deepprofiler</span> <span class="o">--</span><span class="n">root</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">project</span><span class="o">/</span> <span class="o">--</span><span class="n">config</span> <span class="n">filename</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">metadata</span> <span class="n">index</span><span class="o">.</span><span class="n">csv</span> <span class="o">--</span><span class="n">exp</span> <span class="n">experiment_name</span> <span class="n">profile</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Profiling arguments</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--metadata</span> <span class="pre">index.csv</span></code> parameter points to a metadata file from the /inputs/metadata folder.
The <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">filename.json</span></code> parameter points to the name of a file from the /inputs/config folder.
The <code class="docutils literal notranslate"><span class="pre">--exp</span> <span class="pre">experiment_name</span></code> points to a folder in the /outputs/ folder.</p>
</div>
<p>Profiling parameters are regulated in <em>profile</em> section of your config, the example for self-trained models is below.
For specific instructions and config examples see further sections.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;feature_layer&quot;</span><span class="p">:</span> <span class="s2">&quot;pool5&quot;</span><span class="p">,</span>
      <span class="s2">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;checkpoint_0020.hdf5&quot;</span><span class="p">,</span>
      <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">128</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">On configuration parameters</p>
<p>The <code class="docutils literal notranslate"><span class="pre">checkpoint</span></code> parameter points to the name of a file from the <code class="docutils literal notranslate"><span class="pre">/outputs/experiment_name/checkpoint/</span></code> folder.
If your GPU\workstation allows, you can increase <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> to speed up the profiling.</p>
</div>
<div class="tip admonition">
<p class="admonition-title">About feature layers</p>
<p>The <code class="docutils literal notranslate"><span class="pre">feature_layer</span></code> parameter in the configuration file defines the layer of the model to be extracted. <code class="docutils literal notranslate"><span class="pre">pool5</span></code> in this case refers to the average pooling penultimate layer. You might want to experiment with other layers. In our analysis, we found that in the case of EfficientNet, the best downstream results are obtained with <code class="docutils literal notranslate"><span class="pre">block6a_activation</span></code> intermediate layer.</p>
</div>
<p>The extracted features are stored in <code class="docutils literal notranslate"><span class="pre">/outputs/experiment_name/features/</span></code> as NumPy <code class="docutils literal notranslate"><span class="pre">npz</span></code> files for each site (full image). The array of features can be accessed through <code class="docutils literal notranslate"><span class="pre">features</span></code> field of the object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>The order of vectors matches the order of cell locations for the image.</p>
<p>In case you want to run another feature extraction for the same experiment, you will need to move (or remove) the contents of this folder.</p>
</section>
<section id="profiling-with-cell-painting-cnn-model">
<h2><strong>6.2 Profiling with Cell Painting CNN model:</strong><a class="headerlink" href="#profiling-with-cell-painting-cnn-model" title="Permalink to this heading">#</a></h2>
<p>Cell Painting CNN was pre-trained on the diverse dataset (almost 500 treatments and two controls in two different cell lines:
U2OS and A549) of Cell Painting images and can be used primarily for the processing of new Cell Painting experiments.</p>
<p><a class="reference external" href="https://doi.org/10.5281/zenodo.7114558"><em><strong>Cell Painting CNN model can be downloaded here.</strong></em></a></p>
<p><strong>Important:</strong> <em>Cell Painting CNN</em> expects specific order of Cell Painting channels in the input image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">DNA</span> <span class="p">(</span><span class="n">Nucleus</span><span class="p">)</span>
<span class="mf">2.</span> <span class="n">RNA</span> <span class="p">(</span><span class="n">Nucleoli</span><span class="p">,</span> <span class="n">cytoplasmic</span> <span class="n">RNA</span><span class="p">)</span>
<span class="mf">3.</span> <span class="n">ER</span> <span class="p">(</span><span class="n">Endoplasmic</span> <span class="n">reticulum</span><span class="p">)</span>
<span class="mf">4.</span> <span class="n">AGP</span> <span class="p">(</span><span class="n">F</span><span class="o">-</span><span class="n">actin</span> <span class="n">cytoskeleton</span><span class="p">,</span> <span class="n">Golgi</span><span class="p">,</span> <span class="n">plasma</span> <span class="n">membrane</span><span class="p">)</span>
<span class="mf">5.</span> <span class="n">Mito</span> <span class="p">(</span><span class="n">Mitochondria</span><span class="p">)</span>
</pre></div>
</div>
<p>The expected shape of the image is <code class="docutils literal notranslate"><span class="pre">128x128x5</span></code>.</p>
<p>To run an experiment, an experiment folder should be created manually in <code class="docutils literal notranslate"><span class="pre">/outputs/</span></code>, for example  <code class="docutils literal notranslate"><span class="pre">/outputs/experiment/</span></code>
and then create a checkpoint folder <code class="docutils literal notranslate"><span class="pre">/outputs/experiment/checkpoint/</span></code>. The model should be copied into this folder.
After it, the usage of the model does not differ from self-trained models, a configuration example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;feature_layer&quot;</span><span class="p">:</span> <span class="s2">&quot;block6a_activation&quot;</span><span class="p">,</span>
      <span class="s2">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;combinedset_cellsout_e30.hdf5&quot;</span><span class="p">,</span>
      <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">128</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="profiling-with-imagenet-pre-trained-model">
<h2><strong>6.3 Profiling with ImageNet pre-trained model:</strong><a class="headerlink" href="#profiling-with-imagenet-pre-trained-model" title="Permalink to this heading">#</a></h2>
<p>Pre-trained ImageNet model is downloaded automatically for EfficientNet or ResNet to the cache folder of Keras.</p>
<p>The <em>profile</em> section of your config should be adjusted: the <code class="docutils literal notranslate"><span class="pre">checkpoint</span></code> field will have <code class="docutils literal notranslate"><span class="pre">None</span></code> and <code class="docutils literal notranslate"><span class="pre">use_pretrained_input_size</span></code>
is set according to the chosen model.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">crop_generator</span></code> parameter should be set to <code class="docutils literal notranslate"><span class="pre">repeat_channel_crop_generator</span></code>, this crop generator feeds each channel
to the model separately, to match the number of channels of ImageNet, each channel is replicated three times.</p>
<p>Example for <em>EfficientNet-B0</em> model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;use_pretrained_input_size&quot;</span> <span class="p">:</span> <span class="mi">224</span><span class="p">,</span>
      <span class="s2">&quot;feature_layer&quot;</span><span class="p">:</span> <span class="s2">&quot;avg_pool&quot;</span><span class="p">,</span>
      <span class="s2">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span>
      <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">128</span>
    <span class="p">}</span>
</pre></div>
</div>
<div class="tip admonition">
<p class="admonition-title">Features are ordered by channels</p>
<p>As each channel is passed through a model separately in this setup, the output feature vectors are concatenated to
produce one feature vector for an image. The channel order in the concatenated vector matches the order of channels in
the configuration. This is valid <strong>only</strong> for pre-trained (with ImageNet) models used with repeat_channel_crop_generator.</p>
<p><strong>Example:</strong>
Features are extracted for an image with channels [‘DNA’, ‘RNA’, ‘ER’] (as in configuration)
using pre-trained EfficientNet and avg_pool layer. The size of this layer is 1280, thus for three channels the final
feature vector is going to be 3840 and the first 1280 elements will correspond to the ‘DNA’ channel, the next 1280 to ‘RNA’
and final 1280 to ‘ER’.</p>
</div>
</section>
<section id="profiling-with-your-own-trained-model">
<h2><strong>6.4 Profiling with your own trained model:</strong><a class="headerlink" href="#profiling-with-your-own-trained-model" title="Permalink to this heading">#</a></h2>
<p>After training your model, you can profile your data using the checkpoints from the training:</p>
<p>The <em>profile</em> section example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;feature_layer&quot;</span><span class="p">:</span> <span class="s2">&quot;pool5&quot;</span><span class="p">,</span>
      <span class="s2">&quot;checkpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;checkpoint_0020.hdf5&quot;</span><span class="p">,</span>
      <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="mi">128</span>
    <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="optional-project-dependent-functions">
<h2><strong>Optional project-dependent functions:</strong><a class="headerlink" href="#optional-project-dependent-functions" title="Permalink to this heading">#</a></h2>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<strong>Split metadata file</strong>:<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Create multiple files with parts of the index for parallelization purposes. Parallelization is not automatic, it requires manually launching different DeepProfiler instances using different index files. This function just loads the index and creates separate files without repeating information, so a different machine can be assigned to profile different parts of the dataset.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="n">deepprofiler</span> <span class="o">--</span><span class="n">root</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span><span class="n">project</span><span class="o">/</span> <span class="o">--</span><span class="n">config</span> <span class="n">filename</span><span class="o">.</span><span class="n">json</span> <span class="n">split</span>
</pre></div>
</div>
</div>
</details></section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="05-config.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">5. Configuration file and examples</p>
      </div>
    </a>
    <a class="right-next"
       href="07-train.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">7. Training models with DeepProfiler</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-profiling-information"><strong>6.1 General profiling information:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#profiling-with-cell-painting-cnn-model"><strong>6.2 Profiling with Cell Painting CNN model:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#profiling-with-imagenet-pre-trained-model"><strong>6.3 Profiling with ImageNet pre-trained model:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#profiling-with-your-own-trained-model"><strong>6.4 Profiling with your own trained model:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-project-dependent-functions"><strong>Optional project-dependent functions:</strong></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michael Bornholdt, Juan Caicedo, Yu Han, Nikita Moshkov, Rebecca Senft (in alphabetical order)
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>